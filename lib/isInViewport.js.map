{"version":3,"file":"isInViewport.js","sources":["index.js"],"sourcesContent":["import $ from 'jquery'\nimport window from 'window'\n\n/**\n * @author  Mudit Ameta\n * @license https://github.com/zeusdeux/isInViewport/blob/master/license.md MIT\n */\n\n// expose isInViewport as a custom pseudo-selector\n$.extend($.expr.pseudos, {\n  // if $.expr.createPseudo is available, use it\n  'in-viewport': $.expr.createPseudo\n    ? $.expr.createPseudo(argsString => currElement => isInViewport(currElement, getSelectorArgs(argsString)))\n  : (currObj, index, meta) => isInViewport(currObj, getSelectorArgs(meta[3]))\n})\n\n\n// expose isInViewport as a function too\n// this lets folks pass around actual objects as options (like custom viewport)\n// and doesn't tie 'em down to strings. It also prevents isInViewport from\n// having to look up and wrap the dom element corresponding to the viewport selector\n$.fn.isInViewport = function(options) {\n  return this.filter((i, el) => isInViewport(el, options))\n}\n\n$.fn.run = run\n\n// lets you chain any arbitrary function or an array of functions and returns a jquery object\nfunction run(args) {\n  if (arguments.length === 1 && typeof args === 'function') {\n    args = [args]\n  }\n\n  if (!(args instanceof Array)) {\n    throw new SyntaxError('isInViewport: Argument(s) passed to .do/.run should be a function or an array of functions')\n  }\n\n  args.forEach(arg => {\n    if (typeof arg !== 'function') {\n      console.warn('isInViewport: Argument(s) passed to .do/.run should be a function or an array of functions')\n      console.warn('isInViewport: Ignoring non-function values in array and moving on')\n    } else {\n      [].slice.call(this).forEach(t => arg.call($(t)))\n    }\n  })\n\n  return this\n}\n\n\n// gets the width of the scrollbar\nfunction getScrollbarWidth(viewport) {\n  // append a div that has 100% width to get true width of viewport\n  const el = $('<div></div>').css({\n    width: '100%'\n  })\n  viewport.append(el)\n\n  // subtract true width from the viewport width which is inclusive\n  // of scrollbar by default\n  const scrollBarWidth = viewport.width() - el.width()\n\n  // remove our element from DOM\n  el.remove()\n  return scrollBarWidth\n}\n\n\n// Returns true if DOM element `element` is in viewport\nfunction isInViewport(element, options) {\n  let {top, bottom, left, right} = element.getBoundingClientRect()\n\n  let settings = $.extend({\n    tolerance: 0,\n    viewport: window\n  }, options)\n  let isVisibleFlag = false\n  let $viewport = settings.viewport.jquery ? settings.viewport : $(settings.viewport)\n\n  if (!$viewport.length) {\n    console.warn('isInViewport: The viewport selector you have provided matches no element on page.')\n    console.warn('isInViewport: Defaulting to viewport as window')\n    $viewport = $(window)\n  }\n\n  const $viewportHeight = $viewport.height()\n  let $viewportWidth = $viewport.width()\n  const typeofViewport = $viewport[0].toString()\n\n  // if the viewport is other than window recalculate the top,\n  // bottom,left and right wrt the new viewport\n  // the [object DOMWindow] check is for window object type in PhantomJS\n  if ($viewport[0] !== window && typeofViewport !== '[object Window]' && typeofViewport !== '[object DOMWindow]') {\n    // use getBoundingClientRect() instead of $.Offset()\n    // since the original top/bottom positions are calculated relative to browser viewport and not document\n    const viewportRect = $viewport[0].getBoundingClientRect()\n\n    // recalculate these relative to viewport\n    top = top - viewportRect.top\n    bottom = bottom - viewportRect.top\n    left = left - viewportRect.left\n    right = right - viewportRect.left\n\n    // get the scrollbar width from cache or calculate it\n    isInViewport.scrollBarWidth = isInViewport.scrollBarWidth || getScrollbarWidth($viewport)\n\n    // remove the width of the scrollbar from the viewport width\n    $viewportWidth -= isInViewport.scrollBarWidth\n  }\n\n  // handle falsy, non-number and non-integer tolerance value\n  // same as checking using isNaN and then setting to 0\n  // bitwise operators deserve some love too you know\n  settings.tolerance = ~~Math.round(parseFloat(settings.tolerance))\n\n  if (settings.tolerance < 0) {\n    settings.tolerance = $viewportHeight + settings.tolerance // viewport height - tol\n  }\n\n  // the element is NOT in viewport iff it is completely out of\n  // viewport laterally or if it is completely out of the tolerance\n  // region. Therefore, if it is partially in view then it is considered\n  // to be in the viewport and hence true is returned. Because we have adjusted\n  // the left/right positions relative to the viewport, we should check the\n  // element's right against the viewport's 0 (left side), and the element's\n  // left against the viewport's width to see if it is outside of the viewport.\n\n  if (right <= 0 || left >= $viewportWidth) {\n    return isVisibleFlag\n  }\n\n  // if the element is bound to some tolerance\n  isVisibleFlag = settings.tolerance ? top <= settings.tolerance && bottom >= settings.tolerance : bottom > 0 && top <= $viewportHeight\n\n  return isVisibleFlag\n}\n\n\n// get the selector args from the args string proved by Sizzle\nfunction getSelectorArgs(argsString) {\n  if (argsString) {\n    const args = argsString.split(',')\n\n    // when user only gives viewport and no tolerance\n    if (args.length === 1 && isNaN(args[0])) {\n      args[1] = args[0]\n      args[0] = void 0\n    }\n\n    return {\n      tolerance: args[0] ? args[0].trim() : void 0,\n      viewport: args[1] ? $(args[1].trim()) : void 0\n    }\n  }\n  return {}\n}\n"],"names":["this","const","let"],"mappings":"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"}